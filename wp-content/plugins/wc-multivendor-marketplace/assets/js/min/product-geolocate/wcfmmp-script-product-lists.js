jQuery(document).ready(function(o){var t=o(".wcfmmp-product-geolocate-search-form");if(o(".wcfmmp-product-geolocate-search-form").length>0&&o("#wcfmmp_radius_addr").length>0){var e=parseInt(wcfmmp_product_list_options.max_radius),a=document.getElementById("wcfmmp_radius_addr");if("google"==wcfm_maps.lib){var r=new google.maps.Geocoder,i=new google.maps.places.Autocomplete(a);i.addListener("place_changed",function(){var t=i.getPlace();o("#wcfmmp_radius_lat").val(t.geometry.location.lat()),o("#wcfmmp_radius_lng").val(t.geometry.location.lng())})}else var s=new L.Control.Search({container:"wcfm_radius_filter_container",url:"https://nominatim.openstreetmap.org/search?format=json&q={s}",jsonpParam:"json_callback",propertyName:"display_name",propertyLoc:["lat","lon"],marker:L.marker([0,0]),moveToLocation:function(t,e,a){o("#wcfmmp_radius_lat").val(t.lat),o("#wcfmmp_radius_lng").val(t.lng)},initial:!1,collapsed:!1,autoType:!1,minLength:2});if(o("#wcfmmp_radius_range").on("input",function(){o(".wcfmmp_radius_range_cur").html(this.value+wcfmmp_product_list_options.radius_unit),wcfmmp_product_list_options.is_rtl?o(".wcfmmp_radius_range_cur").css("right",this.value/e*o(".wcfm_radius_slidecontainer").outerWidth()-7.5+"px"):o(".wcfmmp_radius_range_cur").css("left",this.value/e*o(".wcfm_radius_slidecontainer").outerWidth()-7.5+"px"),$wcfmmp_radius_lat=o("#wcfmmp_radius_lat").val(),$wcfmmp_radius_lat}),wcfmmp_product_list_options.is_rtl?o(".wcfmmp_radius_range_cur").css("right",o("#wcfmmp_radius_range").val()/e*o(".wcfm_radius_slidecontainer").outerWidth()-7.5+"px"):o(".wcfmmp_radius_range_cur").css("left",o("#wcfmmp_radius_range").val()/e*o(".wcfm_radius_slidecontainer").outerWidth()-7.5+"px"),navigator.geolocation){o(".wcfmmmp_locate_icon").on("click",function(){navigator.geolocation.getCurrentPosition(function(e){console.log(e.coords.latitude,e.coords.longitude),"google"==wcfm_maps.lib?r.geocode({location:{lat:e.coords.latitude,lng:e.coords.longitude}},function(a,r){"OK"===r&&(o("#wcfmmp_radius_addr").val(a[0].formatted_address),o("#wcfmmp_radius_lat").val(e.coords.latitude),o("#wcfmmp_radius_lng").val(e.coords.longitude),t.submit())}):o.get("https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat="+e.coords.latitude+"&lon="+e.coords.longitude,function(a){o("#wcfm_radius_filter_container").find(".search-input").val(a.address.road),o("#wcfmmp_radius_lat").val(e.coords.latitude),o("#wcfmmp_radius_lng").val(e.coords.longitude),t.submit()})})}),wcfmmp_product_list_options.is_geolocate&&(o("#wcfmmp_radius_lat").val()||o(".wcfmmmp_locate_icon").click())}}if(o(".wcfmmp-product-list-map").length>0){o(".wcfmmp-product-list-map").css("height",o(".wcfmmp-product-list-map").outerWidth()/2);var n=[],c=markerClusterer="";if(wcfmmp_product_list_options.is_poi)m=[];else var m=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}];if("google"==wcfm_maps.lib){var l={zoom:$map_zoom,center:new google.maps.LatLng(wcfmmp_product_list_options.default_lat,wcfmmp_product_list_options.default_lng,13),mapTypeId:google.maps.MapTypeId.ROADMAP,styles:m};c=new google.maps.Map(document.getElementById("wcfmmp-product-list-map"),l)}else c=L.map("wcfmmp-product-list-map",{center:[wcfmmp_product_list_options.default_lat,wcfmmp_product_list_options.default_lng],minZoom:2,zoom:13,zoomAnimation:!1}),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{subdomains:["a","b","c"]}).addTo(c),s&&o("#wcfmmp_radius_addr").length>0&&(c.addControl(s),o("#wcfm_radius_filter_container").find(".search-input").addClass("wcfmmp-radius-addr").attr("id","wcfmmp_radius_addr").attr("name","radius_addr").css("float","none").attr("placeholder",wcfmmp_product_list_options.search_location).val(o("#wcfmmp_radius_addr").val()),o("#wcfmmp_radius_addr").remove());!function(){if(o(".wcfmmp-product-list-map").length>0){!function(){if("google"==wcfm_maps.lib)for(var o=0;o<n.length;o++)n[o].setMap(null);n=[]}();var t={search_term:"",wcfmmp_store_category:"",wcfmmp_store_country:"",wcfmmp_store_state:"",action:"wcfmmp_stores_list_map_markers",pagination_base:1,paged:1,per_row:$per_row,per_page:$per_page,includes:$includes,excludes:$excludes,has_product:$has_product,has_orderby:$has_orderby,sidebar:$sidebar,theme:$theme,search_data:""};o.post(wcfm_params.ajax_url,t,function(t){if(t.success){var e=t.data;!function(t){if("google"==wcfm_maps.lib){var e=new google.maps.LatLngBounds,a=new google.maps.InfoWindow;if(o.each(t,function(o,t){var r=new google.maps.LatLng(t.lat,t.lang);e.extend(r);var i={url:t.icon,scaledSize:new google.maps.Size(wcfmmp_product_list_options.icon_width,wcfmmp_product_list_options.icon_height)},s=new google.maps.Marker({position:r,map:c,animation:google.maps.Animation.DROP,title:t.name,icon:i,zIndex:o}),m=t.info_window_content;google.maps.event.addListener(s,"click",function(o,t){return function(){a.setContent(m),a.open(c,o)}}(s)),c.setCenter(s.getPosition()),n.push(s)}),wcfmmp_product_list_options.is_cluster){const o=wcfmmp_product_list_options.cluster_image;markerClusterer&&markerClusterer.clearMarkers(),markerClusterer=new MarkerClusterer(c,n,{imagePath:o})}$auto_zoom&&t.length>0&&c.fitBounds(e)}else o.each(t,function(o,e){var a=L.icon({iconUrl:e.icon,iconSize:[wcfmmp_product_list_options.icon_width,wcfmmp_product_list_options.icon_height]}),r=L.marker([e.lat,e.lang],{icon:a}).bindPopup(e.info_window_content);n.push(r);var i=L.featureGroup(n).addTo(c);$auto_zoom&&t.length>0&&setTimeout(function(){c.fitBounds(i.getBounds())},1e3)})}(o.parseJSON(e))}})}}()}});